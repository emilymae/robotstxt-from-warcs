# bash scripts to massage output from warcbase
When nothing else is specified, tabs is used as separator in data files.


## all_urls.sh
Generate a file with all urls.

 * Input: The results from `extract-urls.scala`
 * Output: `domain url`

```shell
cd /mnt/TNA-Dataset/robots/urls-decc.gov.uk
cat part-[0-9]* | cut -d, -f2,3 --output-delimiter $'\t' | tr -d '\r' | sed 's/)$//' | sort | uniq > urls-decc
```


## all_links.sh
Generate a file with all links from HTML to any url.

 * Input: The results from `extract-links.scala`
 * Output: `source-url target-url`
Note: Comma is used as delimiter in the output from `extract-links.scala`, which seems problematic as URLs can contain commas themselves.

```shell
cd /mnt/TNA-Dataset/robots/links-decc.gov.uk
cat part-[0-9]* | cut -d, -f2,3 | tr -d ')' | tr ',' '\t' | grep http | sort | uniq > links-decc
```


## inside_corpus_links.sh
Keep only the links where the destination is also harvested.

 * Input: `domain url` and `source-url target-url` (generated by `all_urls.sh` and `all_links.sh`)
 * Output: `source-url target-url`

```shell
cd /mnt/TNA-Dataset/robots
export LC_ALL=C ; cat urls-decc.gov.uk/urls-decc | cut -d$'\t' -f2 | sort | uniq > urls-unique-decc
export LC_ALL ; cat links-decc.gov.uk/links-decc | awk -v OFS="\t" -F"\t" '{print $2,$1}' | sort > links_reversed-decc
join -1 1 -2 1 urls-unique-decc links_reversed-decc | awk -v OFS="\t" -F" " '{print $2,$1}' | sort > links-inside-corpus-decc
```


## domain_links.sh
Aggregate domain-to-domain links from url-to-url-links. Used for visualization as the url-to-url granilarity can be overwhelming.

 * Input: `source-url target-url` (generated by `all_links.sh` and `inside_corpus_links.sh`)
 * Output: `source-domain target-domain link-count`

```shell
cd /mnt/TNA-Dataset/robots/links-decc.gov.uk
cat part-[0-9]* | sed 's/[^,]*,\(.*\),\(htt.*\)/\1 \2/' | grep "http.*http" | sed 's/https\?:\/\/\([a-z0-9.-]*\)[^ ]*/\1/g' | sort | uniq -c | sed 's/ \+/ /g' | sed 's/\([^ ]\+\) \([^ ]\+\) \([^ ]\+\)/\2\t\3\t\1/' | sed 's/^ //' > domain_to_domain-decc
```


## robots_or_not.sh
Getting a list of domains in the corpus with a flag indicating is robots.txt exists or not. Intended for visualization along with 

 * Input: The results from `extract-robotstxts.scala`
 * Output: `domain hasrobots` (hasrobots flagged as true|false)

```shell
cd /mnt/TNA-Dataset/robots
cat robots-decc.gov.uk/part-[0-9]* | grep SNIP | cut -d, -f2 | sort | uniq > robots-decc.gov.uk/domains-with-robots-decc
cat urls-decc.gov.uk/urls-decc | cut -d$'\t' -f1 | sort | uniq > urls-decc.gov.uk/domains-decc
comm --output-delimiter : urls-decc.gov.uk/domains-decc robots-decc.gov.uk/domains-with-robots-decc | sed -e 's/^\([^:].*\)/\1\tfalse/' -e 's/::\(.*\)/\1\ttrue/' > domains-robots-flag-decc
```
